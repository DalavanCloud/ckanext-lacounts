// var rows = [{"id": 401, "slug": "apartment-list", "title": "Apartment List", "value": 1, "package": "Private", "url": "/catalog/publisher/apartment-list/"}, {"id": 998, "slug": "calfish", "title": "CalFish", "value": 1, "package": "", "url": "/catalog/publisher/calfish/"}, {"id": 996, "slug": "california-air-resources-board-california-department-of-water-resources", "title": "California Air Resources Board, California Department of Water Resources", "value": 1, "package": "", "url": "/catalog/publisher/california-air-resources-board-california-department-of-water-resources/"}, {"id": 523, "slug": "california-association-of-realtors", "title": "California Association of Realtors", "value": 3, "package": "Trade association", "url": "/catalog/publisher/california-association-of-realtors/"}, {"id": 1126, "slug": "california-department-of-aging", "title": "California Department of Aging", "value": 5, "package": "", "url": "/catalog/publisher/california-department-of-aging/"}, {"id": 1120, "slug": "california-department-of-child-support-services", "title": "California Department of Child Support Services", "value": 4, "package": "", "url": "/catalog/publisher/california-department-of-child-support-services/"}, {"id": 1112, "slug": "california-department-of-public-health", "title": "California Department of Public Health", "value": 70, "package": "", "url": "/catalog/publisher/california-department-of-public-health/"}, {"id": 1117, "slug": "california-department-of-social-services", "title": "California Department of Social Services", "value": 9, "package": "", "url": "/catalog/publisher/california-department-of-social-services/"}, {"id": 1069, "slug": "california-geological-survey", "title": "California Geological Survey", "value": 1, "package": "", "url": "/catalog/publisher/california-geological-survey/"}, {"id": 700, "slug": "california-natural-resources-agency", "title": "California Natural Resources Agency", "value": 24, "package": "", "url": "/catalog/publisher/california-natural-resources-agency/"}, {"id": 1075, "slug": "california-strategic-growth-council", "title": "California Strategic Growth Council", "value": 1, "package": "", "url": "/catalog/publisher/california-strategic-growth-council/"}, {"id": 992, "slug": "california-strategic-growth-council-california-department-of-conservation", "title": "California Strategic Growth Council, California Department of Conservation", "value": 1, "package": "", "url": "/catalog/publisher/california-strategic-growth-council-california-department-of-conservation/"}, {"id": 1070, "slug": "calrecycle", "title": "CalRecycle", "value": 2, "package": "", "url": "/catalog/publisher/calrecycle/"}, {"id": 999, "slug": "caltrans", "title": "Caltrans", "value": 2, "package": "", "url": "/catalog/publisher/caltrans/"}, {"id": 1049, "slug": "city-of-agoura-hills", "title": "City of Agoura Hills", "value": 1, "package": "", "url": "/catalog/publisher/city-of-agoura-hills/"}, {"id": 1006, "slug": "city-of-alhambra", "title": "City of Alhambra", "value": 1, "package": "", "url": "/catalog/publisher/city-of-alhambra/"}, {"id": 1007, "slug": "city-of-arcadia", "title": "City of Arcadia", "value": 1, "package": "", "url": "/catalog/publisher/city-of-arcadia/"}, {"id": 1008, "slug": "city-of-artesia", "title": "City of Artesia", "value": 1, "package": "", "url": "/catalog/publisher/city-of-artesia/"}, {"id": 1009, "slug": "city-of-avalon", "title": "City of Avalon", "value": 1, "package": "", "url": "/catalog/publisher/city-of-avalon/"}, {"id": 1050, "slug": "city-of-azusa", "title": "City of Azusa", "value": 1, "package": "", "url": "/catalog/publisher/city-of-azusa/"}, {"id": 1071, "slug": "city-of-bell", "title": "City of Bell", "value": 1, "package": "", "url": "/catalog/publisher/city-of-bell/"}, {"id": 1036, "slug": "city-of-bellflower", "title": "City of Bellflower", "value": 1, "package": "", "url": "/catalog/publisher/city-of-bellflower/"}, {"id": 1051, "slug": "city-of-bell-gardens", "title": "City of Bell Gardens", "value": 1, "package": "", "url": "/catalog/publisher/city-of-bell-gardens/"}, {"id": 1010, "slug": "city-of-beverly-hills", "title": "City of Beverly Hills", "value": 1, "package": "", "url": "/catalog/publisher/city-of-beverly-hills/"}, {"id": 1011, "slug": "city-of-burbank", "title": "City of Burbank", "value": 1, "package": "", "url": "/catalog/publisher/city-of-burbank/"}, {"id": 1012, "slug": "city-of-calabasas", "title": "City of Calabasas", "value": 1, "package": "", "url": "/catalog/publisher/city-of-calabasas/"}, {"id": 1037, "slug": "city-of-carson", "title": "City of Carson", "value": 1, "package": "", "url": "/catalog/publisher/city-of-carson/"}, {"id": 1052, "slug": "city-of-cerritos", "title": "City of Cerritos", "value": 1, "package": "", "url": "/catalog/publisher/city-of-cerritos/"}, {"id": 1013, "slug": "city-of-claremont", "title": "City of Claremont", "value": 1, "package": "", "url": "/catalog/publisher/city-of-claremont/"}, {"id": 1014, "slug": "city-of-covina", "title": "City of Covina", "value": 1, "package": "", "url": "/catalog/publisher/city-of-covina/"}, {"id": 1005, "slug": "city-of-culver-city", "title": "City of Culver City", "value": 21, "package": "", "url": "/catalog/publisher/city-of-culver-city/"}, {"id": 1015, "slug": "city-of-diamond-bar", "title": "City of Diamond Bar", "value": 1, "package": "", "url": "/catalog/publisher/city-of-diamond-bar/"}, {"id": 1016, "slug": "city-of-downey", "title": "City of Downey", "value": 1, "package": "", "url": "/catalog/publisher/city-of-downey/"}, {"id": 1017, "slug": "city-of-duarte", "title": "City of Duarte", "value": 1, "package": "", "url": "/catalog/publisher/city-of-duarte/"}, {"id": 1018, "slug": "city-of-el-monte", "title": "City of El Monte", "value": 1, "package": "", "url": "/catalog/publisher/city-of-el-monte/"}, {"id": 1038, "slug": "city-of-el-segundo", "title": "City of El Segundo", "value": 1, "package": "", "url": "/catalog/publisher/city-of-el-segundo/"}, {"id": 1039, "slug": "city-of-gardena", "title": "City of Gardena", "value": 1, "package": "", "url": "/catalog/publisher/city-of-gardena/"}, {"id": 662, "slug": "city-of-glendale", "title": "City of Glendale", "value": 9, "package": "City", "url": "/catalog/publisher/city-of-glendale/"}, {"id": 663, "slug": "city-of-glendale-community-development-department", "title": "City of Glendale; Community Development Department", "value": 3, "package": "City", "url": "/catalog/publisher/city-of-glendale-community-development-department/"}, {"id": 664, "slug": "city-of-glendale-glendale-police-department", "title": "City of Glendale; Glendale Police Department", "value": 1, "package": "City", "url": "/catalog/publisher/city-of-glendale-glendale-police-department/"}, {"id": 1040, "slug": "city-of-glendora", "title": "City of Glendora", "value": 1, "package": "", "url": "/catalog/publisher/city-of-glendora/"}, {"id": 1053, "slug": "city-of-hawaiian-gardens", "title": "City of Hawaiian Gardens", "value": 1, "package": "", "url": "/catalog/publisher/city-of-hawaiian-gardens/"}, {"id": 1019, "slug": "city-of-hawthorne", "title": "City of Hawthorne", "value": 1, "package": "", "url": "/catalog/publisher/city-of-hawthorne/"}, {"id": 1054, "slug": "city-of-hermosa-beach", "title": "City of Hermosa Beach", "value": 1, "package": "", "url": "/catalog/publisher/city-of-hermosa-beach/"}, {"id": 1055, "slug": "city-of-hidden-hills", "title": "City of Hidden Hills", "value": 1, "package": "", "url": "/catalog/publisher/city-of-hidden-hills/"}, {"id": 1041, "slug": "city-of-industry", "title": "City of Industry", "value": 1, "package": "", "url": "/catalog/publisher/city-of-industry/"}, {"id": 1020, "slug": "city-of-inglewood", "title": "City of Inglewood", "value": 1, "package": "", "url": "/catalog/publisher/city-of-inglewood/"}, {"id": 1057, "slug": "city-of-lakewood", "title": "City of Lakewood", "value": 1, "package": "", "url": "/catalog/publisher/city-of-lakewood/"}, {"id": 1021, "slug": "city-of-la-mirada", "title": "City of La Mirada", "value": 1, "package": "", "url": "/catalog/publisher/city-of-la-mirada/"}, {"id": 665, "slug": "city-of-lancaster", "title": "City of Lancaster", "value": 1, "package": "City", "url": "/catalog/publisher/city-of-lancaster/"}, {"id": 1056, "slug": "city-of-la-verne", "title": "City of La Verne", "value": 1, "package": "", "url": "/catalog/publisher/city-of-la-verne/"}, {"id": 1000, "slug": "city-of-lawndale", "title": "City of Lawndale", "value": 1, "package": "", "url": "/catalog/publisher/city-of-lawndale/"}, {"id": 1058, "slug": "city-of-lomita", "title": "City of Lomita", "value": 1, "package": "", "url": "/catalog/publisher/city-of-lomita/"}, {"id": 658, "slug": "city-of-long-beach", "title": "City of Long Beach", "value": 66, "package": "City", "url": "/catalog/publisher/city-of-long-beach/"}, {"id": 661, "slug": "city-of-long-beach-long-beach-airport", "title": "City of Long Beach; Long Beach Airport", "value": 2, "package": "City", "url": "/catalog/publisher/city-of-long-beach-long-beach-airport/"}, {"id": 660, "slug": "city-of-long-beach-long-beach-development-services", "title": "City of Long Beach; Long Beach Development Services", "value": 1, "package": "City", "url": "/catalog/publisher/city-of-long-beach-long-beach-development-services/"}, {"id": 659, "slug": "city-of-long-beach-long-beach-police-department", "title": "City of Long Beach; Long Beach Police Department", "value": 6, "package": "City", "url": "/catalog/publisher/city-of-long-beach-long-beach-police-department/"}, {"id": 261, "slug": "city-of-los-angeles", "title": "City of Los Angeles", "value": 932, "package": "City", "url": "/catalog/publisher/city-of-los-angeles/"}, {"id": 298, "slug": "city-of-los-angeles-bureau-of-street-services", "title": "City of Los Angeles; Bureau of Street Services", "value": 2, "package": "City", "url": "/catalog/publisher/city-of-los-angeles-bureau-of-street-services/"}, {"id": 299, "slug": "city-of-los-angeles-city-clerk", "title": "City of Los Angeles; City Clerk", "value": 1, "package": "City", "url": "/catalog/publisher/city-of-los-angeles-city-clerk/"}, {"id": 300, "slug": "city-of-los-angeles-city-controller", "title": "City of Los Angeles; City Controller", "value": 17, "package": "City", "url": "/catalog/publisher/city-of-los-angeles-city-controller/"}, {"id": 262, "slug": "city-of-los-angeles-city-planning", "title": "City of Los Angeles; City Planning", "value": 1, "package": "City", "url": "/catalog/publisher/city-of-los-angeles-city-planning/"}, {"id": 264, "slug": "city-of-los-angeles-los-angeles-department-of-transportation", "title": "City of Los Angeles; Los Angeles Department of Transportation", "value": 3, "package": "City", "url": "/catalog/publisher/city-of-los-angeles-los-angeles-department-of-transportation/"}, {"id": 328, "slug": "fire", "title": "Fire", "value": 1, "package": "City", "url": "/catalog/publisher/fire/"}, {"id": 342, "slug": "public-works", "title": "Public Works", "value": 11, "package": "City", "url": "/catalog/publisher/public-works/"}, {"id": 1001, "slug": "city-of-lynwood", "title": "City of Lynwood", "value": 1, "package": "", "url": "/catalog/publisher/city-of-lynwood/"}, {"id": 1046, "slug": "city-of-malibu", "title": "City of Malibu", "value": 1, "package": "", "url": "/catalog/publisher/city-of-malibu/"}, {"id": 1059, "slug": "city-of-manhattan-beach", "title": "City of Manhattan Beach", "value": 1, "package": "", "url": "/catalog/publisher/city-of-manhattan-beach/"}, {"id": 1022, "slug": "city-of-monrovia", "title": "City of Monrovia", "value": 1, "package": "", "url": "/catalog/publisher/city-of-monrovia/"}, {"id": 1023, "slug": "city-of-montebello", "title": "City of Montebello", "value": 1, "package": "", "url": "/catalog/publisher/city-of-montebello/"}, {"id": 1042, "slug": "city-of-monterey-park", "title": "City of Monterey Park", "value": 1, "package": "", "url": "/catalog/publisher/city-of-monterey-park/"}, {"id": 1060, "slug": "city-of-norwalk", "title": "City of Norwalk", "value": 1, "package": "", "url": "/catalog/publisher/city-of-norwalk/"}, {"id": 666, "slug": "city-of-palmdale", "title": "City of Palmdale", "value": 2, "package": "City", "url": "/catalog/publisher/city-of-palmdale/"}, {"id": 1002, "slug": "city-of-palos-verdes-estates", "title": "City of Palos Verdes Estates", "value": 1, "package": "", "url": "/catalog/publisher/city-of-palos-verdes-estates/"}, {"id": 1003, "slug": "city-of-paramount", "title": "City of Paramount", "value": 1, "package": "", "url": "/catalog/publisher/city-of-paramount/"}, {"id": 265, "slug": "city-of-pasadena", "title": "City of Pasadena", "value": 83, "package": "City", "url": "/catalog/publisher/city-of-pasadena/"}, {"id": 1043, "slug": "city-of-pico-rivera", "title": "City of Pico Rivera", "value": 1, "package": "", "url": "/catalog/publisher/city-of-pico-rivera/"}, {"id": 1061, "slug": "city-of-pomona", "title": "City of Pomona", "value": 2, "package": "", "url": "/catalog/publisher/city-of-pomona/"}, {"id": 1024, "slug": "city-of-rancho-palos-verdes", "title": "City of Rancho Palos Verdes", "value": 1, "package": "", "url": "/catalog/publisher/city-of-rancho-palos-verdes/"}, {"id": 1025, "slug": "city-of-redondo-beach", "title": "City of Redondo Beach", "value": 1, "package": "", "url": "/catalog/publisher/city-of-redondo-beach/"}, {"id": 1027, "slug": "city-of-rolling-hills", "title": "City of Rolling Hills", "value": 1, "package": "", "url": "/catalog/publisher/city-of-rolling-hills/"}, {"id": 1026, "slug": "city-of-rolling-hills-estates", "title": "City of Rolling Hills Estates", "value": 1, "package": "", "url": "/catalog/publisher/city-of-rolling-hills-estates/"}, {"id": 1044, "slug": "city-of-rosemead", "title": "City of Rosemead", "value": 1, "package": "", "url": "/catalog/publisher/city-of-rosemead/"}, {"id": 1062, "slug": "city-of-san-dimas", "title": "City of San Dimas", "value": 1, "package": "", "url": "/catalog/publisher/city-of-san-dimas/"}, {"id": 1063, "slug": "city-of-san-fernando", "title": "City of San Fernando", "value": 1, "package": "", "url": "/catalog/publisher/city-of-san-fernando/"}, {"id": 1064, "slug": "city-of-san-marino", "title": "City of San Marino", "value": 1, "package": "", "url": "/catalog/publisher/city-of-san-marino/"}, {"id": 266, "slug": "city-of-santa-clarita", "title": "City of Santa Clarita", "value": 17, "package": "City", "url": "/catalog/publisher/city-of-santa-clarita/"}, {"id": 1028, "slug": "city-of-santa-fe-springs", "title": "City of Santa Fe Springs", "value": 1, "package": "", "url": "/catalog/publisher/city-of-santa-fe-springs/"}, {"id": 267, "slug": "city-of-santa-monica", "title": "City of Santa Monica", "value": 67, "package": "City", "url": "/catalog/publisher/city-of-santa-monica/"}, {"id": 352, "slug": "city-of-santa-monica-big-blue-bus", "title": "City of Santa Monica; Big Blue Bus", "value": 3, "package": "City", "url": "/catalog/publisher/city-of-santa-monica-big-blue-bus/"}, {"id": 354, "slug": "city-of-santa-monica-city-clerks-office", "title": "City of Santa Monica; City Clerk's Office", "value": 2, "package": "City", "url": "/catalog/publisher/city-of-santa-monica-city-clerks-office/"}, {"id": 355, "slug": "city-of-santa-monica-city-managers-office", "title": "City of Santa Monica; City Manager's Office", "value": 1, "package": "City", "url": "/catalog/publisher/city-of-santa-monica-city-managers-office/"}, {"id": 356, "slug": "city-of-santa-monica-finance-department", "title": "City of Santa Monica; Finance Department", "value": 7, "package": "City", "url": "/catalog/publisher/city-of-santa-monica-finance-department/"}, {"id": 357, "slug": "city-of-santa-monica-information-systems-department", "title": "City of Santa Monica; Information Systems Department", "value": 2, "package": "City", "url": "/catalog/publisher/city-of-santa-monica-information-systems-department/"}, {"id": 358, "slug": "city-of-santa-monica-planning-and-community-development-department", "title": "City of Santa Monica; Planning and Community Development Department", "value": 3, "package": "City", "url": "/catalog/publisher/city-of-santa-monica-planning-and-community-development-department/"}, {"id": 361, "slug": "city-of-santa-monica-rent-control-board", "title": "City of Santa Monica; Rent Control Board", "value": 1, "package": "City", "url": "/catalog/publisher/city-of-santa-monica-rent-control-board/"}, {"id": 362, "slug": "city-of-santa-monica-santa-monica-airport", "title": "City of Santa Monica; Santa Monica Airport", "value": 1, "package": "City", "url": "/catalog/publisher/city-of-santa-monica-santa-monica-airport/"}, {"id": 363, "slug": "city-of-santa-monica-santa-monica-police-department", "title": "City of Santa Monica; Santa Monica Police Department", "value": 1, "package": "City", "url": "/catalog/publisher/city-of-santa-monica-santa-monica-police-department/"}, {"id": 364, "slug": "city-of-santa-monica-santa-monica-public-library", "title": "City of Santa Monica; Santa Monica Public Library", "value": 1, "package": "City", "url": "/catalog/publisher/city-of-santa-monica-santa-monica-public-library/"}, {"id": 1068, "slug": "city-of-santa-monica-planning-and-community-development-department-building-and-safety-division", "title": "City of Santa Monica; Planning and Community Development Department; Building and Safety Division", "value": 1, "package": "", "url": "/catalog/publisher/city-of-santa-monica-planning-and-community-development-department-building-and-safety-division/"}, {"id": 1076, "slug": "city-of-santa-monica-public-works-department-public-landscape-division", "title": "City of Santa Monica; Public Works Department; Public Landscape Division", "value": 1, "package": "", "url": "/catalog/publisher/city-of-santa-monica-public-works-department-public-landscape-division/"}, {"id": 1066, "slug": "city-of-santa-monica-public-works-department-water-resources-division", "title": "City of Santa Monica; Public Works Department; Water Resources Division", "value": 2, "package": "", "url": "/catalog/publisher/city-of-santa-monica-public-works-department-water-resources-division/"}, {"id": 1029, "slug": "city-of-sierra-madre", "title": "City of Sierra Madre", "value": 1, "package": "", "url": "/catalog/publisher/city-of-sierra-madre/"}, {"id": 1045, "slug": "city-of-signal-hill", "title": "City of Signal Hill", "value": 1, "package": "", "url": "/catalog/publisher/city-of-signal-hill/"}, {"id": 1030, "slug": "city-of-south-el-monte", "title": "City of South El Monte", "value": 1, "package": "", "url": "/catalog/publisher/city-of-south-el-monte/"}, {"id": 1031, "slug": "city-of-south-gate", "title": "City of South Gate", "value": 1, "package": "", "url": "/catalog/publisher/city-of-south-gate/"}, {"id": 1032, "slug": "city-of-south-pasadena", "title": "City of South Pasadena", "value": 1, "package": "", "url": "/catalog/publisher/city-of-south-pasadena/"}, {"id": 1073, "slug": "city-of-temple", "title": "City of Temple", "value": 1, "package": "", "url": "/catalog/publisher/city-of-temple/"}, {"id": 1033, "slug": "city-of-torrance", "title": "City of Torrance", "value": 1, "package": "", "url": "/catalog/publisher/city-of-torrance/"}, {"id": 1034, "slug": "city-of-vernon", "title": "City of Vernon", "value": 1, "package": "", "url": "/catalog/publisher/city-of-vernon/"}, {"id": 1065, "slug": "city-of-west-covina", "title": "City of West Covina", "value": 1, "package": "", "url": "/catalog/publisher/city-of-west-covina/"}, {"id": 681, "slug": "city-of-west-hollywood", "title": "City of West Hollywood", "value": 6, "package": "City", "url": "/catalog/publisher/city-of-west-hollywood/"}, {"id": 1035, "slug": "city-of-westlake-village", "title": "City of Westlake Village", "value": 1, "package": "", "url": "/catalog/publisher/city-of-westlake-village/"}, {"id": 1072, "slug": "city-of-whittier", "title": "City of Whittier", "value": 1, "package": "", "url": "/catalog/publisher/city-of-whittier/"}, {"id": 393, "slug": "congressional-data-coalition", "title": "Congressional Data Coalition", "value": 1, "package": "Nonprofit", "url": "/catalog/publisher/congressional-data-coalition/"}, {"id": 268, "slug": "county-of-los-angeles", "title": "County of Los Angeles", "value": 51, "package": "County", "url": "/catalog/publisher/county-of-los-angeles/"}, {"id": 272, "slug": "county-of-los-angeles-arts-commission", "title": "County of Los Angeles; Arts Commission", "value": 4, "package": "County", "url": "/catalog/publisher/county-of-los-angeles-arts-commission/"}, {"id": 273, "slug": "county-of-los-angeles-assessor", "title": "County of Los Angeles; Assessor", "value": 3, "package": "County", "url": "/catalog/publisher/county-of-los-angeles-assessor/"}, {"id": 274, "slug": "county-of-los-angeles-auditor-controller", "title": "County of Los Angeles; Auditor-Controller", "value": 8, "package": "County", "url": "/catalog/publisher/county-of-los-angeles-auditor-controller/"}, {"id": 275, "slug": "county-of-los-angeles-beaches-and-harbors", "title": "County of Los Angeles; Beaches and Harbors", "value": 1, "package": "County", "url": "/catalog/publisher/county-of-los-angeles-beaches-and-harbors/"}, {"id": 278, "slug": "county-of-los-angeles-chief-information-office", "title": "County of Los Angeles; Chief Information Office", "value": 1, "package": "County", "url": "/catalog/publisher/county-of-los-angeles-chief-information-office/"}, {"id": 287, "slug": "county-of-los-angeles-enterprise-gis", "title": "County of Los Angeles; Enterprise GIS", "value": 2, "package": "County", "url": "/catalog/publisher/county-of-los-angeles-enterprise-gis/"}, {"id": 290, "slug": "county-of-los-angeles-human-resources", "title": "County of Los Angeles; Human Resources", "value": 1, "package": "County", "url": "/catalog/publisher/county-of-los-angeles-human-resources/"}, {"id": 707, "slug": "county-of-los-angeles-mental-health", "title": "County of Los Angeles; Mental Health", "value": 3, "package": "County", "url": "/catalog/publisher/county-of-los-angeles-mental-health/"}, {"id": 711, "slug": "county-of-los-angeles-parks-and-recreation", "title": "County of Los Angeles; Parks and Recreation", "value": 3, "package": "County", "url": "/catalog/publisher/county-of-los-angeles-parks-and-recreation/"}, {"id": 717, "slug": "county-of-los-angeles-regional-planning", "title": "County of Los Angeles; Regional Planning", "value": 3, "package": "County", "url": "/catalog/publisher/county-of-los-angeles-regional-planning/"}, {"id": 718, "slug": "county-of-los-angeles-register-recorder-county-clerk", "title": "County of Los Angeles; Register Recorder / County Clerk", "value": 2, "package": "County", "url": "/catalog/publisher/county-of-los-angeles-register-recorder-county-clerk/"}, {"id": 719, "slug": "county-of-los-angeles-sheriffs-department", "title": "County of Los Angeles; Sheriff's Department", "value": 1, "package": "County", "url": "/catalog/publisher/county-of-los-angeles-sheriffs-department/"}, {"id": 720, "slug": "county-of-los-angeles-treasure-and-tax-collector", "title": "County of Los Angeles; Treasure and Tax Collector", "value": 2, "package": "County", "url": "/catalog/publisher/county-of-los-angeles-treasure-and-tax-collector/"}, {"id": 721, "slug": "los-angeles-county-office-of-the-assessor", "title": "Los Angeles County Office of the Assessor", "value": 1, "package": "County", "url": "/catalog/publisher/los-angeles-county-office-of-the-assessor/"}, {"id": 732, "slug": "crisis-text-line", "title": "Crisis Text Line", "value": 1, "package": "Nonprofit", "url": "/catalog/publisher/crisis-text-line/"}, {"id": 1122, "slug": "department-of-community-services-development", "title": "Department of Community Services & Development", "value": 2, "package": "", "url": "/catalog/publisher/department-of-community-services-development/"}, {"id": 1119, "slug": "department-of-developmental-services", "title": "Department of Developmental Services", "value": 8, "package": "", "url": "/catalog/publisher/department-of-developmental-services/"}, {"id": 1114, "slug": "department-of-health-care-service", "title": "Department of Health Care Service", "value": 1, "package": "", "url": "/catalog/publisher/department-of-health-care-service/"}, {"id": 1113, "slug": "department-of-health-care-services", "title": "Department of Health Care Services", "value": 51, "package": "", "url": "/catalog/publisher/department-of-health-care-services/"}, {"id": 1124, "slug": "department-of-managed-health-care", "title": "Department of Managed Health Care", "value": 4, "package": "", "url": "/catalog/publisher/department-of-managed-health-care/"}, {"id": 1118, "slug": "department-of-rehabilitation", "title": "Department of Rehabilitation", "value": 13, "package": "", "url": "/catalog/publisher/department-of-rehabilitation/"}, {"id": 1088, "slug": "department-of-resources-recycling-and-recovery-calrecycle", "title": "Department of Resources Recycling and Recovery (CalRecycle)", "value": 3, "package": "State", "url": "/catalog/publisher/department-of-resources-recycling-and-recovery-calrecycle/"}, {"id": 1121, "slug": "department-of-state-hospitals", "title": "Department of State Hospitals", "value": 2, "package": "", "url": "/catalog/publisher/department-of-state-hospitals/"}, {"id": 1125, "slug": "department-of-veterans-affairs", "title": "Department of Veterans Affairs", "value": 2, "package": "", "url": "/catalog/publisher/department-of-veterans-affairs/"}, {"id": 1127, "slug": "department-of-veterans-affairs-office-of-enterprise-integration-oei", "title": "Department of Veterans Affairs; Office of Enterprise Integration (OEI); ", "value": 2, "package": "", "url": "/catalog/publisher/department-of-veterans-affairs-office-of-enterprise-integration-oei/"}, {"id": 734, "slug": "economic-policy-institute", "title": "Economic Policy Institute", "value": 1, "package": "Nonprofit", "url": "/catalog/publisher/economic-policy-institute/"}, {"id": 1123, "slug": "emergency-medical-services-authority", "title": "Emergency Medical Services Authority", "value": 3, "package": "", "url": "/catalog/publisher/emergency-medical-services-authority/"}, {"id": 1089, "slug": "environmental-protection-agency-calepa", "title": "Environmental Protection Agency (CalEPA)", "value": 7, "package": "State", "url": "/catalog/publisher/environmental-protection-agency-calepa/"}, {"id": 739, "slug": "esri", "title": "ESRI", "value": 1, "package": "Private", "url": "/catalog/publisher/esri/"}, {"id": 1067, "slug": "fairy-godboss", "title": "Fairy Godboss", "value": 2, "package": "", "url": "/catalog/publisher/fairy-godboss/"}, {"id": 740, "slug": "google", "title": "Google", "value": 1, "package": "Private", "url": "/catalog/publisher/google/"}, {"id": 735, "slug": "greeninfo-network", "title": "GreenInfo Network", "value": 2, "package": "Nonprofit", "url": "/catalog/publisher/greeninfo-network/"}, {"id": 745, "slug": "lausd", "title": "LAUSD", "value": 4, "package": "School District", "url": "/catalog/publisher/lausd/"}, {"id": 900, "slug": "los-angeles-homeless-services-authority", "title": "Los Angeles Homeless Services Authority", "value": 1, "package": "", "url": "/catalog/publisher/los-angeles-homeless-services-authority/"}, {"id": 1047, "slug": "los-angeles-times", "title": "Los Angeles Times", "value": 1, "package": "", "url": "/catalog/publisher/los-angeles-times/"}, {"id": 1110, "slug": "measure-america", "title": "Measure of America", "value": 1, "package": "Nonprofit", "url": "/catalog/publisher/measure-america/"}, {"id": 1111, "slug": "measure-of-america-a-project-of-the-social-science-research-council", "title": "Measure of America, a project of the Social Science Research Council", "value": 0, "package": "", "url": "/catalog/publisher/measure-of-america-a-project-of-the-social-science-research-council/"}, {"id": 1077, "slug": "mother-jones", "title": "Mother Jones", "value": 1, "package": "", "url": "/catalog/publisher/mother-jones/"}, {"id": 1074, "slug": "national-archive-of-data-on-arts-and-culture", "title": "National Archive of Data on Arts and Culture", "value": 1, "package": "", "url": "/catalog/publisher/national-archive-of-data-on-arts-and-culture/"}, {"id": 1109, "slug": "national-collegiate-athletic-association", "title": "National Collegiate Athletic Association", "value": 2, "package": "", "url": "/catalog/publisher/national-collegiate-athletic-association/"}, {"id": 991, "slug": "national-endowment-for-the-arts", "title": "National Endowment for the Arts ", "value": 1, "package": "Federal", "url": "/catalog/publisher/national-endowment-for-the-arts/"}, {"id": 1079, "slug": "occupational-safety-and-health-administration", "title": "Occupational Safety and Health Administration", "value": 1, "package": "", "url": "/catalog/publisher/occupational-safety-and-health-administration/"}, {"id": 1116, "slug": "office-of-statewide-health-planning-development", "title": "Office of Statewide Health Planning & Development", "value": 83, "package": "", "url": "/catalog/publisher/office-of-statewide-health-planning-development/"}, {"id": 736, "slug": "openflights", "title": "OpenFlights", "value": 1, "package": "Nonprofit", "url": "/catalog/publisher/openflights/"}, {"id": 1115, "slug": "southern-california-association-of-governments", "title": "Southern California Association of Governments", "value": 33, "package": "", "url": "/catalog/publisher/southern-california-association-of-governments/"}, {"id": 731, "slug": "southern-california-association-of-governments-scag-and-metro", "title": "Southern California Association of Governments (SCAG) and Metro", "value": 1, "package": "Metropolitan planning organization", "url": "/catalog/publisher/southern-california-association-of-governments-scag-and-metro/"}, {"id": 746, "slug": "state-of-california", "title": "State of California", "value": 4, "package": "State", "url": "/catalog/publisher/state-of-california/"}, {"id": 755, "slug": "california-board-of-equalization", "title": "California Board of Equalization", "value": 1, "package": "State", "url": "/catalog/publisher/california-board-of-equalization/"}, {"id": 757, "slug": "california-coastal-commission", "title": "California Coastal Commission", "value": 1, "package": "State", "url": "/catalog/publisher/california-coastal-commission/"}, {"id": 759, "slug": "california-community-colleges-chancellors-office", "title": "California Community Colleges Chancellor's Office", "value": 1, "package": "State", "url": "/catalog/publisher/california-community-colleges-chancellors-office/"}, {"id": 761, "slug": "california-department-of-conservation", "title": "California Department of Conservation", "value": 1, "package": "State", "url": "/catalog/publisher/california-department-of-conservation/"}, {"id": 762, "slug": "california-department-of-education", "title": "California Department of Education", "value": 149, "package": "State", "url": "/catalog/publisher/california-department-of-education/"}, {"id": 763, "slug": "california-department-of-finance", "title": "California Department of Finance", "value": 2, "package": "State", "url": "/catalog/publisher/california-department-of-finance/"}, {"id": 764, "slug": "california-department-of-forestry-and-fire-protection", "title": "California Department of Forestry and Fire Protection", "value": 1, "package": "State", "url": "/catalog/publisher/california-department-of-forestry-and-fire-protection/"}, {"id": 765, "slug": "california-department-of-housing-and-economic-development", "title": "California Department of Housing and Economic Development", "value": 1, "package": "State", "url": "/catalog/publisher/california-department-of-housing-and-economic-development/"}, {"id": 767, "slug": "california-health-and-human-services-agency", "title": "California Health and Human Services Agency", "value": 237, "package": "State", "url": "/catalog/publisher/california-health-and-human-services-agency/"}, {"id": 1078, "slug": "california-state-controller", "title": "California State Controller", "value": 78, "package": "State", "url": "/catalog/publisher/california-state-controller/"}, {"id": 792, "slug": "department-of-general-services", "title": "Department of General Services", "value": 4, "package": "State", "url": "/catalog/publisher/department-of-general-services/"}, {"id": 798, "slug": "department-of-justice", "title": "Department of Justice", "value": 7, "package": "State", "url": "/catalog/publisher/department-of-justice/"}, {"id": 803, "slug": "department-of-public-health", "title": "Department of Public Health", "value": 2, "package": "State", "url": "/catalog/publisher/department-of-public-health/"}, {"id": 806, "slug": "department-of-social-services", "title": "Department of Social Services", "value": 5, "package": "State", "url": "/catalog/publisher/department-of-social-services/"}, {"id": 812, "slug": "department-of-water-resources", "title": "Department of Water Resources", "value": 2, "package": "State", "url": "/catalog/publisher/department-of-water-resources/"}, {"id": 814, "slug": "employment-development-department", "title": "Employment Development Department", "value": 33, "package": "State", "url": "/catalog/publisher/employment-development-department/"}, {"id": 826, "slug": "natural-resources-agency", "title": "Natural Resources Agency", "value": 163, "package": "State", "url": "/catalog/publisher/natural-resources-agency/"}, {"id": 830, "slug": "office-of-environmental-health-hazard-assessment", "title": "Office of Environmental Health Hazard Assessment", "value": 1, "package": "State", "url": "/catalog/publisher/office-of-environmental-health-hazard-assessment/"}, {"id": 832, "slug": "office-of-health-equity-healthy-places-team", "title": "Office of Health Equity, Healthy Places Team", "value": 1, "package": "State", "url": "/catalog/publisher/office-of-health-equity-healthy-places-team/"}, {"id": 841, "slug": "public-workscalifornia-department-of-education", "title": "Public Works/California Department of Education", "value": 1, "package": "State", "url": "/catalog/publisher/public-workscalifornia-department-of-education/"}, {"id": 852, "slug": "state-water-resources-control-board", "title": "State Water Resources Control Board", "value": 11, "package": "State", "url": "/catalog/publisher/state-water-resources-control-board/"}, {"id": 744, "slug": "uc-office-of-president", "title": "UC Office of President", "value": 1, "package": "Public University", "url": "/catalog/publisher/uc-office-of-president/"}, {"id": 997, "slug": "substance-abuse-and-mental-health-services-administration", "title": "Substance Abuse and Mental Health Services Administration", "value": 1, "package": "", "url": "/catalog/publisher/substance-abuse-and-mental-health-services-administration/"}, {"id": 742, "slug": "the-california-state-university", "title": "The California State University", "value": 1, "package": "Public University", "url": "/catalog/publisher/the-california-state-university/"}, {"id": 737, "slug": "the-education-trust-west", "title": "The Education Trust-West", "value": 3, "package": "Nonprofit", "url": "/catalog/publisher/the-education-trust-west/"}, {"id": 741, "slug": "trulia", "title": "Trulia", "value": 1, "package": "Private", "url": "/catalog/publisher/trulia/"}, {"id": 990, "slug": "united-states-department-of-justice", "title": "United States Department of Justice", "value": 2, "package": "", "url": "/catalog/publisher/united-states-department-of-justice/"}, {"id": 995, "slug": "united-states-geological-survey", "title": "United States Geological Survey", "value": 1, "package": "", "url": "/catalog/publisher/united-states-geological-survey/"}, {"id": 993, "slug": "university-of-nebraska-lincoln", "title": "University of Nebraska-Lincoln", "value": 1, "package": "", "url": "/catalog/publisher/university-of-nebraska-lincoln/"}, {"id": 989, "slug": "urban-institute", "title": "Urban Institute", "value": 1, "package": "Nonprofit", "url": "/catalog/publisher/urban-institute/"}, {"id": 1080, "slug": "us-federal-government", "title": "US Federal Government", "value": 0, "package": "", "url": "/catalog/publisher/us-federal-government/"}, {"id": 1081, "slug": "centers-for-disease-control-and-prevention", "title": "Centers for Disease Control and Prevention", "value": 1, "package": "State", "url": "/catalog/publisher/centers-for-disease-control-and-prevention/"}, {"id": 1082, "slug": "institute-of-museum-and-library-services", "title": "Institute of Museum and Library Services", "value": 17, "package": "Federal", "url": "/catalog/publisher/institute-of-museum-and-library-services/"}, {"id": 1085, "slug": "united-states-department-of-education", "title": "United States Department of Education", "value": 1, "package": "Federal", "url": "/catalog/publisher/united-states-department-of-education/"}, {"id": 1086, "slug": "us-census-bureau", "title": "US Census Bureau", "value": 7, "package": "Federal", "url": "/catalog/publisher/us-census-bureau/"}, {"id": 1083, "slug": "us-department-of-education", "title": "U.S. Department of Education", "value": 2, "package": "Federal", "url": "/catalog/publisher/us-department-of-education/"}, {"id": 1084, "slug": "us-department-of-housing-and-urban-development", "title": "US Department of Housing and Urban Development", "value": 5, "package": "State", "url": "/catalog/publisher/us-department-of-housing-and-urban-development/"}, {"id": 1087, "slug": "us-government-publishing-office", "title": "US Government Publishing Office", "value": 1, "package": "Federal", "url": "/catalog/publisher/us-government-publishing-office/"}, {"id": 1048, "slug": "wittgenstein-centre-for-demography-and-global-human-capital", "title": "Wittgenstein Centre for Demography and Global Human Capital", "value": 1, "package": "", "url": "/catalog/publisher/wittgenstein-centre-for-demography-and-global-human-capital/"}, {"id": 738, "slug": "world-cities-culture-forum", "title": "World Cities Culture Forum", "value": 8, "package": "Nonprofit", "url": "/catalog/publisher/world-cities-culture-forum/"}];

var svg = d3.select("svg"),
    width = +svg.attr("width"),
    height = +svg.attr("height");

var format = d3.format(",d");

var color = d3.scaleOrdinal(d3.schemeCategory20c);

var pack = d3.pack()
    .size([width, height])
    .padding(1.5);


var root = d3.hierarchy({children: rows})
    .sum(function(d) { return d.value; })
    .each(function(d) {
      if (id = d.data.id) {
        d.id = id;
        d.title = d.data.title;
        d.class = d.data.title;
        d.package = d.data.package;
        d.url = d.data.url;
      }
    });

var tooltip = d3.select("body")
  .append("div")
  .attr('id', 'bubble-tooltip')
  .style("position", "absolute")
  .style("visibility", "hidden")
  .style("color", "white")
  .style("padding", "8px")
  .style("background-color", "#626D71")
  .style("border-radius", "6px")
  .style("text-align", "center")
  .style("width", "200px")
  .text("");

var node = svg.selectAll(".node")
  .data(pack(root).leaves())
  .enter().append("g")
    .attr("class", "node")
    .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; })
    .on("mouseover", function(d){
      tooltip.html(d.title + ' ('+d.value+')');
      return tooltip.style("visibility", "visible");})
    .on("mousemove", function(){
      return tooltip.style("top", (d3.event.pageY-10)+"px").style("left",(d3.event.pageX+10)+"px");})
    .on("mouseout", function(){return tooltip.style("visibility", "hidden");});

node.append("circle")
    .attr("id", function(d) { return d.id; })
    .attr("r", function(d) { return d.r; })
    .style("fill", function(d) { return color(d.package); });

node.append("clipPath")
    .attr("id", function(d) { return "clip-" + d.id; })
  .append("use")
    .attr("xlink:href", function(d) { return "#" + d.id; });

//TODO make anchor tag to d.url ('#' is fine otherwise)
node.append("a").attr("href", function(d) { return d.url || '#' })
  .append("text")
    .attr('dominant-baseline', 'central')
    .attr("clip-path", function(d) { return "url(#clip-" + d.id + ")"; })
  .selectAll("tspan")
  .data(function(d) { return d.title.split(/(?=[A-Z][^A-Z])/g); })
  .enter().append("tspan")
    .attr('alignment-baseline', 'central')
    .attr("x", 0)
    .attr("y", function(d, i, nodes) {
        var fontSize = 16;
        var padding = 2;
        var fontFullSize = fontSize + padding;
        var maxHeight = (nodes.length * fontFullSize) - fontFullSize;
        var topLine = (maxHeight / 2) * -1;
        var thisLine = topLine + (i * fontFullSize);
        return thisLine;
      }
    )
    .text(function(d) { return d; });

node.append("title")
      .text(function(d) { return d.title + "\n" + format(d.value); });

node.selectAll("g > a > text")
  .style("opacity", function(d) {
    var box = this.getBoundingClientRect();
    var width = d.r * 2;
    var height = d.r * 2;
    if(box.width <= width && box.height <= height) {
      return 1; // fits, show the text
    } else {
      return 0; // does not fit, make transparent
    }
  });


//Build up Legend Data
var legendData = {};
for (i = 0; i < rows.length; i++) {
    var rowPackage = rows[i].package;
    if (rowPackage == "") {
        rowPackage = "Uncategorized";
    }

    if (rowPackage in legendData) {
      legendData[rowPackage]['count']++;
    } else {
      var rowColor = color(rowPackage);
      legendData[rowPackage] = {
        "color": rowColor,
        "text": rowPackage,
        "count": 1
      };
    }
}

var legendRectSize = 18;
var legendSpacing = 4;
//Add Legend, convert data to array
legendDataArray = Object.keys(legendData).map(function (key) { return legendData[key]; });

var legendWrapper = svg
  .append('g')
  .attr('class', 'legend-wrapper')
  .attr('transform', function() {
    var svgBox = svg.node().getBBox();
    var publisherTab = jQuery('.container');
    // console.log(publisherTab.width());
    return 'translate(' + (publisherTab.width() - 250) + ', 150)';
  });

var legendBackground = legendWrapper
  .append('rect')
  .attr('class', 'legend-background');

var legend = legendWrapper.selectAll('.legend')
  .data(legendDataArray)
  .enter()
  .append('g')
  .attr('class', 'legend')
  .attr('transform', function(d, i) {
    var height = legendRectSize + legendSpacing;
    var offset =  height * legendDataArray.length / 2;
    var horz = -2 * legendRectSize;
    var vert = i * height - offset;
    return 'translate(' + horz + ',' + vert + ')';
  });

legend.append('rect')
  .attr('width', legendRectSize)
  .attr('height', legendRectSize)
  .style('fill', function(d) { return d.color; });

legend.append('text')
  .attr('x', legendRectSize + legendSpacing)
  .attr('y', legendRectSize - legendSpacing)
  .attr('text-anchor', 'start')
  .text(function(d) { return d.text; });

legendBackground
  .attr('width', function() {
    var legendBox = d3.select('.legend-wrapper').node().getBBox();
    return legendBox.width + 20;
  })
  .attr('height', function() {
    var legendBox = d3.select('.legend-wrapper').node().getBBox();
    return legendBox.height + 20;
  })
  .attr('transform', function(d, i) {
    var legendBox = d3.select('.legend-wrapper').node().getBBox();
    var horz = legendBox.x;
    var vert = legendBox.y;
    return 'translate(' + (horz - 10) + ',' + (vert - 10) + ')';
  })
  .style('fill', '#FFFFFF')
  .style("stroke", '#b2d4dc')
  .style("stroke-width", 1);

//// Draw rects, and color them by original_index
//legend.append("rect")
//    .attr("width", 8)
//    .attr("height", 8)
//    .style("fill", function(d){return color(d.original_index)});
//
//legend.append("text")
//    .attr("x", function(d,i){ return d.depth*10 +10;})
//    .attr("dy", "0.50em")
//    .text(function(d){return d.title;})

